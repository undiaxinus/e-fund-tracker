<div class="my-entries-container">
  <div class="my-entries-header">
    <h1>My Fund Entries</h1>
    <div class="header-actions">
      <button 
        class="btn btn-secondary" 
        (click)="clearFilters()"
        [disabled]="isLoading"
      >
        <span class="icon">ğŸ”„</span>
        Clear Filters
      </button>
      <button 
        *ngIf="filteredEntries.length > 0" 
        class="btn btn-outline" 
        (click)="exportEntries()"
      >
        <span class="icon">ğŸ“Š</span>
        Export
      </button>
      <button 
        class="btn btn-primary" 
        (click)="createNewEntry()"
      >
        <span class="icon">â•</span>
        New Entry
      </button>
    </div>
  </div>

  <!-- Statistics Section -->
  <div class="statistics-section">
    <h2>My Entry Statistics</h2>
    <div class="stats-cards">
      <div class="stat-card">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-content">
          <h3>{{ stats.total }}</h3>
          <p>Total Entries</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">â³</div>
        <div class="stat-content">
          <h3>{{ stats.pending }}</h3>
          <p>Pending Review</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">âœ…</div>
        <div class="stat-content">
          <h3>{{ stats.approved }}</h3>
          <p>Approved</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">âŒ</div>
        <div class="stat-content">
          <h3>{{ stats.rejected }}</h3>
          <p>Rejected</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“„</div>
        <div class="stat-content">
          <h3>{{ stats.draft }}</h3>
          <p>Draft</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-content">
          <h3>â‚±{{ stats.totalAmount | number:'1.2-2' }}</h3>
          <p>Total Amount</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“…</div>
        <div class="stat-content">
          <h3>{{ stats.thisMonth }}</h3>
          <p>This Month</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Search and Filters -->
  <div class="filters-section">
    <h2>Search & Filter My Entries</h2>
    
    <!-- Basic Search -->
    <div class="search-basic">
      <div class="search-input-group">
        <input 
          type="text" 
          [(ngModel)]="filters.searchTerm" 
          placeholder="Search by ID, payee, or description..."
          class="search-input"
          (keyup.enter)="applyFilters()"
        >
        <button 
          class="btn btn-primary search-btn" 
          (click)="applyFilters()"
          [disabled]="isLoading"
        >
          <span class="icon" *ngIf="!isLoading">ğŸ”</span>
          <span class="icon" *ngIf="isLoading">â³</span>
          {{ isLoading ? 'Searching...' : 'Search' }}
        </button>
      </div>
    </div>

    <!-- Advanced Filters -->
    <div class="filters-grid">
      <div class="filter-group">
        <label for="classification">Classification:</label>
        <select 
          id="classification" 
          [(ngModel)]="filters.classification"
          (change)="applyFilters()"
        >
          <option value="">All Classifications</option>
          <option *ngFor="let classification of classifications" [value]="classification">
            {{ classification }}
          </option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="status">Status:</label>
        <select 
          id="status" 
          [(ngModel)]="filters.status"
          (change)="applyFilters()"
        >
          <option value="">All Statuses</option>
          <option *ngFor="let status of statuses" [value]="status">
            {{ status }}
          </option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="department">Department:</label>
        <select 
          id="department" 
          [(ngModel)]="filters.department"
          (change)="applyFilters()"
        >
          <option value="">All Departments</option>
          <option *ngFor="let department of departments" [value]="department">
            {{ department }}
          </option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="fundSource">Fund Source:</label>
        <select 
          id="fundSource" 
          [(ngModel)]="filters.fundSource"
          (change)="applyFilters()"
        >
          <option value="">All Fund Sources</option>
          <option *ngFor="let source of fundSources" [value]="source">
            {{ source }}
          </option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="dateFrom">Date From:</label>
        <input 
          id="dateFrom" 
          type="date" 
          [(ngModel)]="filters.dateFrom"
          (change)="applyFilters()"
        >
      </div>
      
      <div class="filter-group">
        <label for="dateTo">Date To:</label>
        <input 
          id="dateTo" 
          type="date" 
          [(ngModel)]="filters.dateTo"
          (change)="applyFilters()"
        >
      </div>
    </div>
  </div>

  <!-- Results Section -->
  <div class="results-section">
    <div class="results-header">
      <h2>My Entries</h2>
      <div class="results-info" *ngIf="!isLoading">
        <span class="results-count">{{ totalItems }} entry(ies) found</span>
        <span class="results-showing" *ngIf="totalItems > 0">
          Showing {{ (currentPage - 1) * itemsPerPage + 1 }} - 
          {{ currentPage * itemsPerPage > totalItems ? totalItems : currentPage * itemsPerPage }} of {{ totalItems }}
        </span>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading">
      <div class="loading-spinner"></div>
      <p>Loading your entries...</p>
    </div>

    <!-- No Results -->
    <div class="no-results" *ngIf="!isLoading && filteredEntries.length === 0">
      <div class="no-results-icon">ğŸ“</div>
      <h3>No entries found</h3>
      <p>You haven't created any entries yet or no entries match your search criteria.</p>
      <button class="btn btn-primary" (click)="createNewEntry()">
        <span class="icon">â•</span>
        Create Your First Entry
      </button>
    </div>

    <!-- Results Table -->
    <div class="results-table-container" *ngIf="!isLoading && filteredEntries.length > 0">
      <table class="results-table">
        <thead>
          <tr>
            <th (click)="sort('id')" class="sortable">
              ID {{ getSortIcon('id') }}
            </th>
            <th (click)="sort('payee')" class="sortable">
              Payee {{ getSortIcon('payee') }}
            </th>
            <th (click)="sort('amount')" class="sortable">
              Amount {{ getSortIcon('amount') }}
            </th>
            <th (click)="sort('date')" class="sortable">
              Date {{ getSortIcon('date') }}
            </th>
            <th (click)="sort('classification')" class="sortable">
              Classification {{ getSortIcon('classification') }}
            </th>
            <th (click)="sort('status')" class="sortable">
              Status {{ getSortIcon('status') }}
            </th>
            <th (click)="sort('createdAt')" class="sortable">
              Created {{ getSortIcon('createdAt') }}
            </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let entry of paginatedEntries">
            <td class="id-cell">{{ entry.id }}</td>
            <td class="payee-cell">{{ entry.payee }}</td>
            <td class="amount-cell">â‚±{{ entry.amount | number:'1.2-2' }}</td>
            <td class="date-cell">{{ formatDate(entry.date) }}</td>
            <td class="classification-cell">
              <span class="classification-badge" [ngClass]="entry.classification">
                {{ entry.classification }}
              </span>
            </td>
            <td class="status-cell">
              <span class="status-badge" [style.background-color]="getStatusColor(entry.status)">
                {{ entry.status }}
              </span>
              <div class="status-info" *ngIf="entry.status === 'REJECTED' && entry.comments">
                <small class="rejection-reason">{{ entry.comments }}</small>
              </div>
            </td>
            <td class="created-cell">{{ formatDate(entry.createdAt) }}</td>
            <td class="actions-cell">
              <button 
                class="btn btn-sm btn-outline" 
                (click)="viewDetails(entry)"
                title="View Details"
              >
                ğŸ‘ï¸
              </button>
              <button 
                *ngIf="canEditEntry(entry)" 
                class="btn btn-sm btn-primary" 
                (click)="editEntry(entry)"
                title="Edit Entry"
              >
                âœï¸
              </button>
              <button 
                class="btn btn-sm btn-secondary" 
                (click)="duplicateEntry(entry)"
                title="Duplicate Entry"
              >
                ğŸ“‹
              </button>
              <button 
                *ngIf="canSubmitEntry(entry)" 
                class="btn btn-sm btn-success" 
                (click)="submitEntry(entry)"
                title="Submit for Review"
              >
                ğŸ“¤
              </button>
              <button 
                *ngIf="canDeleteEntry(entry)" 
                class="btn btn-sm btn-danger" 
                (click)="deleteEntry(entry)"
                title="Delete Entry"
                [disabled]="isDeleting"
              >
                ğŸ—‘ï¸
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="!isLoading && totalPages > 1">
      <button 
        class="btn btn-outline" 
        (click)="changePage(currentPage - 1)"
        [disabled]="currentPage === 1"
      >
        Previous
      </button>
      
      <span class="page-info">
        Page {{ currentPage }} of {{ totalPages }}
      </span>
      
      <button 
        class="btn btn-outline" 
        (click)="changePage(currentPage + 1)"
        [disabled]="currentPage === totalPages"
      >
        Next
      </button>
    </div>
  </div>

  <!-- Entry Details Modal -->
  <div class="modal-overlay" *ngIf="selectedEntry" (click)="selectedEntry = null">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Entry Details</h3>
        <button class="modal-close" (click)="selectedEntry = null">Ã—</button>
      </div>
      
      <div class="modal-body">
        <div class="entry-details">
          <div class="detail-section">
            <h4>Entry Information</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <label>ID:</label>
                <span>{{ selectedEntry.id }}</span>
              </div>
              <div class="detail-item">
                <label>Payee:</label>
                <span>{{ selectedEntry.payee }}</span>
              </div>
              <div class="detail-item">
                <label>Amount:</label>
                <span class="amount">â‚±{{ selectedEntry.amount | number:'1.2-2' }}</span>
              </div>
              <div class="detail-item">
                <label>Date:</label>
                <span>{{ formatDate(selectedEntry.date) }}</span>
              </div>
              <div class="detail-item">
                <label>Classification:</label>
                <span class="classification-badge" [ngClass]="selectedEntry.classification">
                  {{ selectedEntry.classification }}
                </span>
              </div>
              <div class="detail-item">
                <label>Status:</label>
                <span class="status-badge" [style.background-color]="getStatusColor(selectedEntry.status)">
                  {{ selectedEntry.status }}
                </span>
              </div>
              <div class="detail-item">
                <label>Department:</label>
                <span>{{ selectedEntry.department }}</span>
              </div>
              <div class="detail-item">
                <label>Fund Source:</label>
                <span>{{ selectedEntry.fundSource }}</span>
              </div>
            </div>
            <div class="detail-item full-width">
              <label>Description:</label>
              <p>{{ selectedEntry.description }}</p>
            </div>
          </div>
          
          <div class="detail-section">
            <h4>Timeline</h4>
            <div class="timeline">
              <div class="timeline-item">
                <div class="timeline-icon">ğŸ“</div>
                <div class="timeline-content">
                  <h5>Created</h5>
                  <p>{{ formatDateTime(selectedEntry.createdAt) }}</p>
                </div>
              </div>
              <div class="timeline-item" *ngIf="selectedEntry.submittedAt">
                <div class="timeline-icon">ğŸ“¤</div>
                <div class="timeline-content">
                  <h5>Submitted</h5>
                  <p>{{ formatDateTime(selectedEntry.submittedAt) }}</p>
                </div>
              </div>
              <div class="timeline-item" *ngIf="selectedEntry.reviewedAt">
                <div class="timeline-icon" [ngClass]="{
                  'approved': selectedEntry.status === 'APPROVED',
                  'rejected': selectedEntry.status === 'REJECTED'
                }">{{ selectedEntry.status === 'APPROVED' ? 'âœ…' : 'âŒ' }}</div>
                <div class="timeline-content">
                  <h5>{{ selectedEntry.status === 'APPROVED' ? 'Approved' : 'Rejected' }}</h5>
                  <p>{{ formatDateTime(selectedEntry.reviewedAt) }}</p>
                  <p *ngIf="selectedEntry.reviewedBy"><small>by {{ selectedEntry.reviewedBy }}</small></p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="detail-section" *ngIf="selectedEntry.comments">
            <h4>Comments</h4>
            <div class="comments">
              <p>{{ selectedEntry.comments }}</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-outline" (click)="selectedEntry = null">Close</button>
        <button 
          *ngIf="canEditEntry(selectedEntry!)" 
          class="btn btn-primary" 
          (click)="editEntry(selectedEntry!); selectedEntry = null"
        >
          <span class="icon">âœï¸</span>
          Edit Entry
        </button>
        <button 
          class="btn btn-secondary" 
          (click)="duplicateEntry(selectedEntry!); selectedEntry = null"
        >
          <span class="icon">ğŸ“‹</span>
          Duplicate
        </button>
      </div>
    </div>
  </div>
</div>